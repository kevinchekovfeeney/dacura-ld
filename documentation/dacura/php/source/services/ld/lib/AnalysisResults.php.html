<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
require_once(&quot;RequestAnalysisResults.php&quot;);
require_once(&quot;GraphAnalysisResults.php&quot;);

class AnalysisResults {
	var $action;
	var $test = false;
	var $msg_title = &quot;&quot;;//for error messages or special messages
	var $msg_body = &quot;&quot;;//same
	var $decision; //reject,confirm,pending,accept
	var $errcode = 0;
	var $errors = array();
	var $warnings = array();

	function __construct($action, $test = false){
		$this-&gt;action = $action;
		$this-&gt;test = $test;
	}
	
	function ok(){
		return !($this-&gt;errcode &gt; 0);
	}

	function status(){
		return $this-&gt;decision;
	}
	
	function addWarning($action, $prompt, $txt){
		$this-&gt;warnings[] = array(&quot;action&quot; =&gt; $action, &quot;msg_title&quot; =&gt; $prompt, &quot;msg_body&quot; =&gt; $txt);
	}			

	function addError($errcode, $action, $prompt, $txt = &quot;&quot;, $type = false){
		if($type == false){
			switch($errcode){
				case 500:
					$type = &quot;internal&quot;;
					break;
				case 403:
					$type = &quot;permission&quot;;
					break;
				case 404:
					$type = &quot;addressing&quot;;
					break;
				case 400:
					$type = &quot;input&quot;;
					break;
				case 200:
					$type = &quot;policy&quot;;
					break;
				default:
					$type = &quot;unspecified&quot;;
					break;
			}
		}
		$this-&gt;errors[] = array(&quot;code&quot; =&gt; $errcode, &quot;type&quot; =&gt; $type, &quot;action&quot; =&gt; $action, &quot;msg_title&quot; =&gt; $prompt, &quot;msg_body&quot; =&gt; $txt);
	}
	
	function is_pending(){
		return ($this-&gt;decision == &quot;pending&quot;);
	}

	function is_accept(){
		return ($this-&gt;decision == &quot;accept&quot; or !$this-&gt;decision);
	}

	function is_reject(){
		return ($this-&gt;decision == &quot;reject&quot;);
	}
	
	function is_error(){
		return $this-&gt;errcode &gt; 0;
	}
	
	function is_confirm(){
		return $this-&gt;decision == &quot;confirm&quot;;
	}
	
	function accept(){
		$this-&gt;decision = &quot;accept&quot;;
		return $this;
	}
	
	function success($decision){
		$this-&gt;decision = $decision;
		if($this-&gt;decision == &quot;pending&quot;){
			$this-&gt;msg_title == $this-&gt;action .&quot; requires approval&quot;;
		}
		return $this;
	}	
	
	function pending($msg_title, $msg_body = false){
		$this-&gt;decision = &quot;pending&quot;;
		$this-&gt;msg_title = $msg_title;
		if($msg_body){
			$this-&gt;msg_body = $msg_body;
		}
		return $this;
	}

	function reject($msg_title, $msg_body){
		$this-&gt;decision = &quot;reject&quot;;
		$this-&gt;msg_body = $msg_body;
		$this-&gt;msg_title = $msg_title;
		return $this;
	}
	
	function failure($errcode, $msg_title, $msg_body, $type = false){
		$this-&gt;decision = &quot;reject&quot;;
		$this-&gt;errcode = $errcode;
		$this-&gt;msg_title = $msg_title;
		$this-&gt;msg_body = $msg_body;
		return $this;
	}
	
	function add($sub, $chain = true){
		if($chain){
			$this-&gt;errors = array_merge($this-&gt;errors, $sub-&gt;errors);
			$this-&gt;warnings = array_merge($this-&gt;warnings, $sub-&gt;warnings);
		}
		switch($sub-&gt;decision) {
			case &quot;reject&quot; :
				if($sub-&gt;is_error()){
					$this-&gt;addError($sub-&gt;errcode, $sub-&gt;action, $sub-&gt;msg_title, $sub-&gt;msg_body);
					if(!$this-&gt;is_error()){
						$this-&gt;errcode = $sub-&gt;errcode;
						$this-&gt;msg_title = &quot;Error in &quot;.$sub-&gt;action;						
					}
				}
				else { //if the sub is already in reject state, we save details of second reject
					$this-&gt;addError(200, $sub-&gt;action, $sub-&gt;msg_title, $sub-&gt;msg_body);
					if(!$this-&gt;is_reject()){
						$this-&gt;msg_title = &quot;Rejected by &quot;.$sub-&gt;action;
					}
				}
				$this-&gt;decision = &quot;reject&quot;;
			break;
			case &quot;confirm&quot; :
				$this-&gt;addWarning($sub-&gt;action, $sub-&gt;msg_title.&quot; requires confirmation by user.&quot;, $sub-&gt;msg_body);
				if($this-&gt;is_accept()){
					$this-&gt;decision = &quot;confirm&quot;;
					$this-&gt;msg_title = $sub-&gt;action. &quot; requires confirm &quot;;						
				}
			break;
			case &quot;pending&quot; :
				$this-&gt;addWarning($sub-&gt;action, $sub-&gt;msg_title.&quot; requires approval.&quot;, $sub-&gt;msg_body);
				if($this-&gt;is_accept()){
					$this-&gt;decision = &quot;pending&quot;;
					$this-&gt;msg_title = $sub-&gt;action . &quot; requires approval&quot;;
				}
			break;
			case &quot;accept&quot; :
				if($this-&gt;is_accept()){
					$this-&gt;decision = &quot;accept&quot;;
				}
			break;
		}
	}	
}


</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>