<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
class FakeTripleStore {
	var $fname;
	var $ts = array();

	function __construct($fname){
		$this-&gt;fname = $fname;
		$this-&gt;loadTS();
	}

	function loadTS(){
		$this-&gt;ts = json_decode(file_get_contents($this-&gt;fname), true);
		if(!$this-&gt;ts){
			$this-&gt;ts = array();
		}
	}

	function save(){
		file_put_contents($this-&gt;fname, json_encode($this-&gt;ts));
	}


	function includesQuad($quad){
		if(isset($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]])){
			foreach($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]] as $oq){
				if($oq &amp;&amp; $quad[2] &amp;&amp; json_encode($oq) == json_encode($quad[2])) return true;
			}
		}
		return false;
	}

	function removeQuad($quad){
		if(isset($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]])){
			foreach($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]] as $i =&gt; $oq){
				if($oq &amp;&amp; $quad[2] &amp;&amp; json_encode($oq) == json_encode($quad[2])){
					unset($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]][$i]);
					if(count($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]]) == 0){
						unset($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]]);
					}
					if(count($this-&gt;ts[$quad[3]][$quad[0]]) == 0){
						unset($this-&gt;ts[$quad[3]][$quad[0]]);
					}
					return true;
				}
			}
		}
		return false;
	}

	function addQuad($quad){
		if($this-&gt;includesQuad($quad)) return false;
		if(!isset($this-&gt;ts[$quad[3]])){
			$this-&gt;ts[$quad[3]] = array();
		}
		if(!isset($this-&gt;ts[$quad[3]][$quad[0]])){
			$this-&gt;ts[$quad[3]][$quad[0]] = array();
		}
		if(!isset($this-&gt;ts[$quad[3]][$quad[0]][$quad[1]])){
			$this-&gt;ts[$quad[3]][$quad[0]][$quad[1]] = array();
		}
		$this-&gt;ts[$quad[3]][$quad[0]][$quad[1]][] = $quad[2];
		return true;
	}

	function update($iquads, $dquads, $is_test){
		$errors = array();
		//$errors[] = array(&quot;type&quot; =&gt; &quot;Some Weird Shite1&quot;, &quot;quads&quot; =&gt; $iquads);
		//$errors[] = array(&quot;type&quot; =&gt; &quot;Some Weird Shite2&quot;, &quot;quads&quot; =&gt; $dquads);
		foreach($dquads as $dq){
			if(!$this-&gt;removeQuad($dq)){
				$errors[] = array(&quot;type&quot; =&gt; &quot;DeleteNonExistentQuad&quot;, &quot;quads&quot; =&gt; $dq);
			}
		}
		foreach($iquads as $iq){
			if(!$this-&gt;addQuad($iq)){
				$errors[] = array(&quot;type&quot; =&gt; &quot;AddAlreadyExistingQuad&quot;, &quot;quads&quot; =&gt; $iq);
			}
		}
		if(!$is_test &amp;&amp; count($errors) == 0){
			$this-&gt;save();
		}
		return $errors;
	}

	function html(){
		$html = &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Graph&lt;/th&gt;&lt;th&gt;Subject&lt;/th&gt;&lt;th&gt;Predicate&lt;/th&gt;&lt;th&gt;Object&lt;/th&gt;&lt;/tr&gt;&quot;;
		foreach($this-&gt;ts as $gname =&gt; $trips){
			foreach($trips as $sub =&gt; $preds){
				foreach($preds as $pred =&gt; $val){
					if(is_array($val)) $val = json_encode($val);
					$html .= &quot;&lt;tr&gt;&lt;td&gt;$gname&lt;/td&gt;&lt;td&gt;$sub&lt;/td&gt;&lt;td&gt;$pred&lt;/td&gt;&lt;td&gt;$val&lt;/td&gt;&lt;/tr&gt;&quot;;
				}
			}
		}
		$html .= &quot;&lt;/table&gt;&quot;;
		return $html;
	}

}
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>