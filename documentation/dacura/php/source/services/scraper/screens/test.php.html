<html>
    <head>
        <script
            type="text/javascript"
            src="../../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">

&lt;script&gt;
	dacura.scraper.getParseTableHTML = function(variable, factoids){
		//alert(factoids.length);
		var html = &quot;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Row&lt;/th&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Value (from)&lt;/th&gt;&lt;th&gt;Value (to)&lt;/th&gt;&quot;;
		html += &quot;&lt;th&gt;Date (from)&lt;/th&gt;&lt;th&gt;Date (to)&lt;/th&gt;&lt;th&gt;Value Type&lt;/th&gt;&lt;th&gt;Date Type&lt;/th&gt;&lt;th&gt;Notes&lt;/th&gt;&lt;/tr&gt;&quot;;
		for(var i = 0; i&lt;factoids.length; i++){
			factoid = factoids[i];
			html += &quot;&lt;tr&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + (i+1) + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + variable + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.value_from + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.value_to + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.date_from + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.date_to + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.value_type + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.date_type + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;td&gt;&quot; + factoid.comment + &quot;&lt;/td&gt;&quot;;
			html += &quot;&lt;/tr&gt;&quot;;
		}
		html += &quot;&lt;/table&gt;&quot;;
		return html;
	};
&lt;/script&gt;
   &lt;div id=&quot;scraper-pane-holder&quot;&gt;
		 &lt;ul id=&quot;scraper-pane-list&quot; class=&quot;dch&quot;&gt;
		 	&lt;li&gt;&lt;a href=&quot;#scraper-test&quot;&gt;Test Variable Value&lt;/a&gt;&lt;/li&gt;
		 	&lt;?php if($dacura_server-&gt;userHasRole(&quot;admin&quot;)) {?&gt;&lt;li&gt;&lt;a href=&quot;#scraper-testpage&quot;&gt;Test Page&lt;/a&gt;&lt;/li&gt;&lt;?php }?&gt;
		&lt;/ul&gt;
		&lt;div id=&quot;scraper-test&quot; class=&quot;scraper-pane dch&quot;&gt;
			&lt;div class=&quot;sholder&quot;&gt;
				&lt;p&gt;Enter a seshat value into the box below to see how the Scraper will turn the value into datapoints&lt;/p&gt;
				&lt;table&gt;&lt;tr&gt;&lt;td&gt;
				&lt;div id=&quot;saddmsg&quot;&gt;&lt;/div&gt;
				&lt;textarea id=&quot;seshatvalue&quot;&gt;&lt;/textarea&gt;
				&lt;/td&gt;&lt;td align=&quot;center&quot; valign=&quot;bottom&quot;&gt;
					&lt;a class=&quot;button2&quot; href=&quot;javascript:dacura.scraper.test()&quot;&gt;Analyse&lt;/a&gt;
					&lt;a id=&quot;clear&quot; class=&quot;dch&quot; style=&quot;margin-bottom: 4px&quot; href=&quot;javascript:dacura.scraper.cleartest()&quot;&gt;Clear&lt;/a&gt;
					
				&lt;/td&gt;
				&lt;/tr&gt;&lt;/table&gt;
			&lt;/div&gt;	
			&lt;div class=&quot;sresults&quot;&gt;&lt;/div&gt;
		&lt;/div&gt;
		&lt;?php if($dacura_server-&gt;userHasRole(&quot;admin&quot;)) {?&gt;
			&lt;div id=&quot;scraper-testpage&quot; class=&quot;scraper-pane dch&quot;&gt;
				&lt;div id=&quot;tpaddmsg&quot;&gt;&lt;/div&gt;
				&lt;div class=&quot;tpholder&quot;&gt;
					&lt;label&gt;URL:&lt;/label&gt; &lt;input id='parseurl' type='text' size=40&gt;
				&lt;/div&gt;	
				&lt;div class=&quot;pcsection pcbuttons&quot;&gt;
					&lt;a class=&quot;button2&quot; href=&quot;javascript:dacura.scraper.testpage()&quot;&gt;Test Page&lt;/a&gt;
					
				&lt;/div&gt;
				&lt;div class=&quot;tpresults&quot;&gt;&lt;/div&gt;
			&lt;/div&gt;
		&lt;?php } ?&gt;		
	&lt;/div&gt;

&lt;script&gt;
	dacura.scraper.cleartest = function(){
		$('#scraper-results').remove();
		$(&quot;#saddmsg&quot;).html(&quot;&quot;);
		$('#seshatvalue').val(&quot;&quot;);
		$('#clear').hide();	
	}		
			
	dacura.scraper.test = function(){
		$('#scraper-results').remove();
		$('#clear').show();
		$(&quot;#saddmsg&quot;).html(&quot;&quot;);
		var ajs = dacura.scraper.api.parseValue();
		ajs.data.data = $('#seshatvalue').val();
		$.ajax(ajs)
			.done(function(data, textStatus, jqXHR) {
				try {
					var x = JSON.parse(data);					
					var html = &quot;&lt;div id='scraper-results' class='test-results test-results-&quot; + x.result_code + &quot;'&gt;&quot;;
					if(x.result_code == &quot;error&quot;){
						html += &quot;&lt;h3&gt;Error :&lt;i&gt;&quot; + x.value + &quot;&lt;/i&gt;&lt;/h3&gt;&quot;;
						html += &quot;&lt;p&gt;&quot; + x.result_message + &quot;&lt;/p&gt;&quot;;
					}
					else {
						html += &quot;&lt;h3&gt;Results for &lt;i&gt;&quot; + x.value + &quot;&lt;/i&gt;&lt;/h3&gt;&quot;;
					}
					if(x.result_code == &quot;warning&quot;){
						html += &quot;&lt;p&gt;&lt;strong&gt;Warning&lt;/strong&gt;: &quot; + x.result_message + &quot;&lt;/p&gt;&quot;;
					}
					if(typeof x.datapoints !== &quot;undefined&quot;){
						html += dacura.scraper.getParseTableHTML('VAR', x.datapoints);
					}
					html += &quot;&lt;/dl&gt;&lt;/div&gt;&quot;;
					$('.sresults').html(html);
				}
				catch(e){
					dacura.system.writeErrorMessage(&quot;&quot;, &quot;#saddmsg&quot;, &quot;&quot;, &quot;Error: &quot; + e.message);
					
				}
			})
			.fail(function (jqXHR, textStatus){
				dacura.system.writeErrorMessage(&quot;&quot;, &quot;#saddmsg&quot;, &quot;&quot;, &quot;Error: &quot; + jqXHR.responseText );
			}
		);	
	};

	&lt;?php if($dacura_server-&gt;userHasRole(&quot;admin&quot;)) {?&gt;
		dacura.scraper.testpage = function(){
			$('#testpage-results').remove();
			$(&quot;#tpaddmsg&quot;).html(&quot;&quot;);
			var page = $('#parseurl').val();
			if(!dacura.system.validateURL(page)){
				return dacura.system.writeErrorMessage(&quot;&quot;, &quot;#tpaddmsg&quot;, &quot;&quot;, &quot;Error: &quot; + ajs.data.url + &quot; is not a valid url&quot;);					
			}
			var ajs = dacura.scraper.api.parsePage(page);
			ajs.beforeSend = function(){
				dacura.system.showBusyOverlay(&quot;#scraper-testpage&quot;, &quot;&quot;, &quot;Fetching &quot; + ajs.data.url);
			};
			ajs.complete = function(){
				dacura.system.removeBusyOverlay(&quot;#scraper-testpage&quot;);
			};
			$.ajax(ajs)
				.done(function(data, textStatus, jqXHR) {
					try {
						var x = JSON.parse(data);
						var html = &quot;&lt;div id='testpage-results'&gt;&quot;;
						html += &quot;&lt;h3&gt;Results&lt;/h3&gt;&quot;;
						html += &quot;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;NGA&lt;/th&gt;&lt;th&gt;Polity&lt;/th&gt;&lt;th&gt;Section&lt;/th&gt;&lt;th&gt;Subsection&lt;/th&gt;&lt;th&gt;Variable&lt;/th&gt;&lt;th&gt;Value From&lt;/th&gt;&lt;th&gt;Value To&lt;/th&gt;&lt;th&gt;&quot;;
						html += &quot;Date From&lt;/th&gt;&lt;th&gt;Date To&lt;/th&gt;&lt;th&gt;Fact Type&lt;/th&gt;&lt;th&gt;Value Note&lt;/th&gt;&lt;th&gt;Date Note&lt;/th&gt;&lt;th&gt;Comment&lt;/th&gt;&lt;/tr&gt;&lt;thead&gt;&lt;tbody&gt;&quot;;
						for(var i = 0; i &lt; x.length; i++){
							html + &quot;&lt;tr&gt;&quot;;
							for(j=0; j&lt;x[i].length; j++) {
								html += &quot;&lt;td&gt;&quot; + x[i][j] + &quot;&lt;/td&gt;&quot;;
							}
							html += &quot;&lt;/tr&gt;&quot;;
						}
						html += &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
						html += &quot;&lt;/div&gt;&quot;;
						$('.tpresults').html(html);
					}
					catch(e){
						dacura.system.writeErrorMessage(&quot;&quot;, &quot;#tpaddmsg&quot;, &quot;&quot;, &quot;Error: &quot; + e.message);					
					}
				})
				.fail(function (jqXHR, textStatus){
					dacura.system.writeErrorMessage(&quot;&quot;, &quot;#tpaddmsg&quot;, &quot;&quot;, &quot;Error: &quot; + jqXHR.responseText );
				});	
		};
	&lt;?php } ?&gt;
	
    $('document').ready(function(){
		$(&quot;button&quot;).button();
		$(&quot;#scraper-pane-list&quot;).show();
		$(&quot;#scraper-pane-holder&quot;).tabs();
	});
	&lt;/script&gt;
</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>