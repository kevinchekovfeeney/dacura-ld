<html>
    <head>
        <script
            type="text/javascript"
            src="../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * Class which parses the URL input and turns it into a structured service call
 * 
 * It does not validate the call by checking the ids, just parses it
 * * Creation Date: 20/11/2014
 * @author Chekov
 * @license GPL v2
 */
class ServiceCall extends DacuraObject {
	/** @var string the collection id in the call */
	var $collection_id;
	/** @var string the service named in the call */
	var $servicename;
	/** @var array the arguments passed in the call */
	var $args = array();
	/** @var string a code indicating where the call came from (html | api) */
	var $provenance;
	/** @var string the raw URL path that was used to invoke the service */
	var $rawpath;

	/**
	 * Parses the input url into its components
	 * 
	 * pattern of input urls is /[collection_id]/service_id/screen/args...
	 * @param string[] a list of all the service names on the system
	 */
	function parseURLInput($snames){
		$this-&gt;rawpath = isset($_GET['path']) ? $_GET['path'] : &quot;&quot;;
		$path = (isset($_GET['path']) &amp;&amp; $_GET['path']) ? explode(&quot;/&quot;, $_GET['path']) : array();
		if(count($path) &gt; 0 &amp;&amp; $path[count($path) -1] == &quot;&quot;) {
			array_pop($path);
		}
		if(count($path) == 0){	//no collection id specified - set to root context
			$this-&gt;collection_id = &quot;all&quot;;
			$this-&gt;servicename = &quot;&quot;;
			$this-&gt;args = array();
		}
		elseif($path[0] == 'system' or in_array($path[0], $snames)){
			if($path[0] == 'system') array_shift($path);
			$this-&gt;collection_id = &quot;all&quot;;
			$this-&gt;servicename = array_shift($path);
			$this-&gt;args = $path;
		}			
		elseif(count($path) == 1){
			$cs_id = array_shift($path);
			if(in_array($cs_id, $snames)){
				$this-&gt;collection_id = &quot;all&quot;;
				$this-&gt;servicename = $cs_id;
			}
			else {
				$this-&gt;collection_id = $cs_id;
				$this-&gt;servicename = &quot;&quot;;
			}		
			$this-&gt;args = array();
		}
		else {
			$cs_id = array_shift($path);
			if(in_array($cs_id, $snames)){
				$this-&gt;collection_id = &quot;all&quot;;
				$this-&gt;servicename = $cs_id;
			}
			else {
				$this-&gt;collection_id = $cs_id;					
				$this-&gt;servicename = isset($path[0]) ? array_shift($path) : &quot;&quot;;
			}
			$this-&gt;args = $path;
		}
	}

	/**
	 * Is the user in their home context?
	 * @return boolean true if they are
	 */
	function inHomeContext(){
		return ($this-&gt;collection_id == &quot;all&quot; &amp;&amp; $this-&gt;servicename == &quot;&quot;);
	}
	
	/**
	 * Return the name of the service in the call
	 */
	function name(){
		return $this-&gt;servicename;
	}
	/**
	 * Get argument number n
	 * @param number $n
	 * @return string the argument's value
	 */
	function getArg($n=0){
		return isset($this-&gt;args[$n]) ? $this-&gt;args[$n] : false;
	}
	
	/**
	 * The collection id passed in the call
	 * @return string collection id
	 */
	function getCollectionID(){
		return $this-&gt;collection_id;
	}
	/**
	 * Where did the call come from?
	 * @param string $x html | rest
	 */
	function setProvenance($x){
		$this-&gt;provenance = $x;
	}
}</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>