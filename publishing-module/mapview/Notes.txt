usamap_viewer.php uses the kmlLayer of google maps api to create objects on a map.

It reads all user defined values for mode, year, motivations and category and calls kml_loader.3php.

kml_loader3_php imports kmlDefault.xml, which has all of the USA state borders through time and all of the events currently recorded in the uspv, and runs a
series of filters, updating the xml dynamically and returning a customized version of it to google maps, which will then display what's in it.
Everything in the kml that's inside a <Placemark> tag can be made into a visual objet on google maps if it has <coordinates>. <Polygon>'s become state borders
and <Point>'s become event markers. What kml_loader3.php does is unset or empty all <Placemark>'s that don't meet the filters set by the user.

The script that will generate the xml (kml_loader3.php) has to be on the server. A static xml can be sent on the url field too, but it also needs to be hosted
online.

Initially, every new query was accessing the triplestore, but that proved too time consuming for bigger time ranges, which is why I created the kmlDefault.xml
file, with all events currently recorded. This file needs to be updated regularly. updateKmlDefaut.php does that when run. It needs to be scheduled depending on
how often the database is updated.

TO DO: right now, the keys of the heatmap are hardcoded. Depending on how many events happened at each state, the <styleUrl>
will change. The fixed set of keys show a scale of one to 10. When a bigger range is given, like a decade, most of the map would then
become dark red, so these numbers need to be generated dynamically according to the max number of events in a state (see line 91 of kml_loader3.php).
I have been able to dynamically change colors (lines 126-140 of code) but I couldn't find a way to update the keys in
usamap_viewer.php. Someone with a slightly better understanding of Ajax could probably do it very quickly.

Please make sure the files included on lines 7, 8 and 10 of usamap_viewer.php are in the right directory (or change the address in the code).